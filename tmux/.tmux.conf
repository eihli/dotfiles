# ── Prefix ────────────────────────────────────────────────────────
# C-] to avoid conflict with emacs
unbind-key C-b
set-option -g prefix C-]
bind-key C-] send-prefix

# ── Reload ────────────────────────────────────────────────────────
bind r source-file ~/.tmux.conf \; display "Config reloaded"

# ── Pane navigation (hjkl) ───────────────────────────────────────
unbind-key j
bind j select-pane -D
unbind-key k
bind k select-pane -U
unbind-key h
bind h select-pane -L
unbind-key l
bind l select-pane -R

# ── Pane resize ──────────────────────────────────────────────────
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r H resize-pane -L 5
bind -r L resize-pane -R 5

bind M-j resize-pane -D
bind M-k resize-pane -U
bind M-h resize-pane -L
bind M-l resize-pane -R

# ── Splits ───────────────────────────────────────────────────────
bind-key v split-window -h -c "#{pane_current_path}"
bind-key s split-window -v -c "#{pane_current_path}"

# New window also inherits path
bind-key c new-window -c "#{pane_current_path}"

# ── Dev layout ───────────────────────────────────────────────────
bind-key T source-file ~/.tmux/dev

# ── Window (tab) navigation ──────────────────────────────────────
bind -r C-o rotate-window

# Swap panes
bind > swap-pane -D
bind < swap-pane -U

# Sync panes toggle
bind S setw synchronize-panes \; display "Sync #{?synchronize-panes,ON,OFF}"

# Quick window switching (no prefix needed)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# ── Copy/paste (emacs mode) ─────────────────────────────────────
set -gw mode-keys emacs

if-shell "uname | grep Darwin" \
"bind-key -T copy-mode M-w send-keys -X copy-pipe 'pbcopy'" \
"if-shell 'test -n \"$WAYLAND_DISPLAY\"' \
  'bind-key -T copy-mode M-w send-keys -X copy-pipe \"wl-copy\"' \
  'bind-key -T copy-mode M-w send-keys -X copy-pipe \"xclip -selection clipboard\"'"

# ── Terminal / display ───────────────────────────────────────────
set -g default-terminal 'tmux-256color'
set -as terminal-overrides ",alacritty:RGB"
set -sg escape-time 10
set -g focus-events on
set -g mouse on

# Start window/pane numbering at 1 (matches keyboard layout)
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# Increase history limit
set -g history-limit 50000

# ── Notifications ────────────────────────────────────────────────
set -g bell-action any
set -g visual-bell off
set -g monitor-activity on

# ── Mouse ────────────────────────────────────────────────────────
set -g mouse on

# ── Shell ────────────────────────────────────────────────────────
# Use fish if available (finds correct path on macOS/Linux)
if-shell "command -v fish" 'run-shell "tmux set-option -g default-shell $(command -v fish)"'

# ── Status bar ───────────────────────────────────────────────────
set -g status-position top
set -g status-style 'bg=default,fg=white'
set -g status-left '#[bold]#S #[default]│ '
set -g status-left-length 20
set -g status-right '#{?synchronize-panes,#[fg=red bold]SYNC #[default],}%H:%M'
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format '#[bold,underscore] #I:#W '

# ── Local overrides ─────────────────────────────────────────────
if-shell -b 'test -e "$HOME/.tmux.env.conf"' \
	 'source-file "$HOME/.tmux.env.conf"' \
